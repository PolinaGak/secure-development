# NFR.md — Таблица требований безопасности

| ID     | Название                  | Описание                                                | Метрика/Порог                                    | Проверка (чем/где)                          | Компонент       | Приоритет |
|--------|---------------------------|---------------------------------------------------------|--------------------------------------------------|---------------------------------------------|-----------------|-----------|
| NFR-01 | Хранение паролей          | Хэширование паролей только Argon2id                     | t=3, m=256MB, p=1                                | Конфиг + unit-тесты                         | auth            | High      |
| NFR-02 | Унифицированные ответы    | При неверных кредах — одинаковый ответ и без причин в логах | 100% failed auth → HTTP 401 `{ "error":"invalid_credentials" }`; p95 timing diff ≤50ms | Контракт-тесты + лог-скан (CI)              | auth / logging  | High      |
| NFR-03 | Ограничение попыток входа | Throttle по аккаунту и по IP                            | ≤5 неуспешных/15min по аккаунту; ≤200 попыток/час по IP | Интеграционные тесты + метрики             | auth / gateway  | High      |
| NFR-04 | TTL токенов и ротация     | Короткоживущие access token; секреты в менеджере секретов | access TTL ≤15m; refresh TTL ≤7d; rotate ≤90d    | Проверка конфигурации + ревью infra         | auth / ops      | High      |
| NFR-05 | Авторизация (RBAC/Owner)  | Изменяющие операции доступны только владельцу/ролям     | 100% изменений проверяют owner_id/role           | Контрактные и e2e тесты                     | api             | High      |
| NFR-06 | Атомарность резервирования| Одна успешная резервация при конкуренции                | при 100 параллельных попыток — ровно 1 success   | Конкурентные нагрузочные тесты (k6/locust)  | wishlist / db   | High      |
| NFR-07 | Валидация входных данных  | Все поля проходят валидацию/экранирование               | 100% полей валидированы; no `<script>` stored    | Unit-tests + DAST                           | api / db / ui   | Medium    |
| NFR-08 | Логи без секретов         | Логи структурированные, без паролей/токенов             | 0% логов с секретами; JSON + correlation_id     | Secret-scanner в CI + ревью логгера         | logging         | High      |
